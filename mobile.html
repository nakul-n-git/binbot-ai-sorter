<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BinBot Mobile</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
  <style>
  body {
  margin: 0;
  padding: 0;
  font-family: 'Baloo 2', cursive;
  background: url('images/background/gradient.jpg') center/cover no-repeat fixed;
  color: #2e7d32;
  text-align: center;
  position: relative;
  z-index: 0;
  width: 100vw;           /* ‚úÖ Lock viewport width */
  height: 100vh;          /* ‚úÖ Lock viewport height */
  overflow-x: hidden;     /* ‚úÖ Prevent horizontal scroll */
  box-sizing: border-box; /* ‚úÖ Ensure padding doesn't break layout */
}

/* White overlay */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 255, 255, 0.3); /* üëà 30% white opacity */
  z-index: -1;
  pointer-events: none;
}

    .logo-container {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  animation: logoPop 0.5s ease-out;
}

.logo-image {
  width: 200px;
  height: auto;
  max-height: 150px;
}

    .credit-text {
      font-size: 0.9rem;
      margin-top: 4px;
      margin-bottom: 12px;
      color: #4e342e;
      font-style: italic;
    }

#video-container {
  position: relative;
  width: 100%;
  max-width: 360px;
  margin: 0 auto;
}

#webcam {
  width: 100%;
  max-width: 320px;
  aspect-ratio: 4 / 3; /* üëà Keeps consistent shape */
  object-fit: cover;
  border-radius: 16px;
  background-color: #f0f0f0;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.3);
}

    #scan-crop {
      position: absolute;
      top: 20%;
      left: 10%;
      width: 80%;
      height: 60%;
      border: 2px dashed #81c784;
      border-radius: 12px;
      pointer-events: none;
    }

#scan-beam {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(to right, #39ff14, #b0ffb0); /* Neon green gradient */
  animation: beamMove 2s infinite linear, beamGlow 1.5s infinite ease-in-out;
  display: none;
  box-shadow: 0 0 12px #39ff14, 0 0 24px #39ff14, 0 0 36px #39ff14;
  z-index: 10;
  border-radius: 2px;
}

@keyframes beamMove {
  0% { top: 0; }
  100% { top: 100%; }
}

@keyframes beamGlow {
  0%, 100% {
    box-shadow: 0 0 12px #39ff14, 0 0 24px #39ff14, 0 0 36px #39ff14;
  }
  50% {
    box-shadow: 0 0 24px #39ff14, 0 0 36px #39ff14, 0 0 48px #39ff14;
  }
}

    #photo-overlay {
  position: absolute;
  bottom: 10px;
  right: 10px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid #81c784;
  background-color: rgba(255,255,255,0.8);
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  z-index: 2;
}

#mascot-image {
  width: 100%;
  height: auto;
  object-fit: contain;
  transition: transform 0.3s ease;
  z-index: 2;
}

#mascot-image.bounce {
  animation: mascotBounce 0.6s;
}

@keyframes mascotBounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-8px); }
  60% { transform: translateY(-4px); }
}

    

   .result-box {
  margin-top: 12px;
  font-size: 1.1rem;
  font-weight: bold;
  border-radius: 12px;
  padding: 8px 16px;
  box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
  transition: background-color 0.3s ease;
}

/* Default */
.result-default {
  background-color: #e8f5e9;
  border: 2px solid #81c784;
  color: #2e7d32;
}

/* Plastic ‚Üí Red */
.result-plastic {
  background-color: #ffebee;
  border: 2px solid #e53935;
  color: #b71c1c;
}

/* Paper ‚Üí Amber */
.result-paper {
  background-color: #fff8e1;
  border: 2px solid #ffb300;
  color: #ff6f00;
}

/* Organic ‚Üí Green */
.result-organic {
  background-color: #e8f5e9;
  border: 2px solid #388e3c;
  color: #1b5e20;
}

    .camera-controls {
      margin-top: 12px;
    }

 /* Base button style */
button {
  font-family: 'Segoe UI', sans-serif;
  font-size: 1rem;
  font-weight: 600;
  padding: 12px 20px;
  margin: 6px;
  border: none;
  border-radius: 14px;
  background: linear-gradient(145deg, #ffffff, #e0f7fa);
  color: #2e7d32;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  cursor: pointer;
}

/* Hover effect */
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.25);
}

/* Active click effect */
button:active {
  transform: scale(0.98);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* Specific button themes */
.start-button {
  background: linear-gradient(145deg, #42a5f5, #1e88e5);
  color: #fff;
}

.stop-button {
  background: linear-gradient(145deg, #ef5350, #e53935);
  color: #fff;
}


.big-identify-button {
  background: linear-gradient(145deg, #66bb6a, #43a047);
  color: #fff;
  font-size: 1.2rem;
  padding: 14px 28px;
  border-radius: 16px;
}

#camera-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
 
  color: #2e7d32;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 12px;
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
  z-index: 5;
  display: block; /* Hidden by default */
}

.credit-text {
  font-size: 0.95rem;
  margin-top: 8px;
  margin-bottom: 16px;
  color: #ffffff;
  background: rgba(0, 0, 0, 0.3);
  padding: 8px 12px;
  border-radius: 12px;
  display: inline-block;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-style: italic;
}

.credit-text strong {
  color: #ffeb3b;
  font-weight: bold;
}

.credit-text .mission {
  display: block;
  margin-top: 4px;
  font-size: 0.85rem;
  color: #c8e6c9;
}

.quote-band {
  background-color: rgba(0, 0, 0, 0.4); /* üëà Transparent black */
  color: #ffffff;
  font-size: 1.1rem;
  text-align: center;
  padding: 12px 16px;
  margin-top: 20px;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.2);
  border-top: 2px solid #4caf50;
  border-bottom: 2px solid #4caf50;
}

#scan-frame {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 80%;
  height: 60%;
  transform: translate(-50%, -50%);
  border: 2px dashed #FFC107;
  border-radius: 12px;
  pointer-events: none;
  z-index: 1;
}

#intro-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom right, #a5d6a7, #81d4fa);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 20px;
}

#intro-image {
  width: 160px;
  height: auto;
  margin-bottom: 30px;
  margin-top: -60px;
}

#play-intro,
#skip-intro {
  display: block;           /* Treat buttons as block-level elements */
  margin: 10px auto;        /* Center horizontally */
  text-align: center;       /* Center text inside the button */
  width: fit-content;       /* Shrink button to fit its content */
}

#play-intro {
  background: linear-gradient(145deg, #66bb6a, #43a047);
  color: #fff;
}

#skip-intro {
  background: linear-gradient(145deg, #ef5350, #e53935);
  color: #fff;
}



  </style>
</head>
<body>
<div id="intro-overlay">
  <img src="images/logo/BB.png" alt="BinBot" id="intro-image" />
  <button id="play-intro">Tap to Learn How BinBot Works!</button>
  <button id="skip-intro">Skip Intro</button>
</div>

  <div class="logo-container">
  <img src="images/logo/binbot.png" alt="BinBot Logo" class="logo-image" />
</div>
<div class="credit-text">
  <span class="creator">Created by <strong>Nakul</strong> and <strong>Navish</strong></span> <br>
  <span class="mission">Class 4, AECS, Pazhayakayal</span>
</div>

  <div id="video-container">
    <video id="webcam" autoplay playsinline muted></video>
	<div id="scan-frame"></div>
  <div id="camera-message">Camera is off. Tap "Start Camera" to begin!</div>
    <div id="scan-beam"></div>
    <div id="photo-overlay">
  <img id="mascot-image" src="images/logo/BB_face.png" alt="BinBot Mascot" />
</div>
  </div>

<button class="big-identify-button" onclick="identifyOnce()">üîç Identify</button>
<div id="result-box" class="result-box result-default">Waiting for identification</div>
 <div class="camera-controls">
  <button class="start-button" onclick="startCamera()">Start Camera</button>
  <button class="stop-button" onclick="stopCamera()">Stop Camera</button>
</div>

<div class="quote-band">
  Even smart bots make silly guesses! <br> I'm still learning, just like you!
</div>

  <script>
    let model, webcamStream, isVoiceOn = true;

window.onload = async () => {
      await loadModel();
      speak("BinBot is ready!");
    };
	
    async function loadModel() {
      	const URL = "https://teachablemachine.withgoogle.com/models/3RzYKWPgW/";
		const modelURL = URL + "model.json";
		const metadataURL = URL + "metadata.json";

model = await tmImage.load(modelURL, metadataURL);
      console.log("Model loaded");
	  
 // üî• Warm-up with blank canvas
  const dummyCanvas = document.createElement("canvas");
  dummyCanvas.width = 160;
  dummyCanvas.height = 160;
  const dummyCtx = dummyCanvas.getContext("2d");
  dummyCtx.fillStyle = "#fff";
  dummyCtx.fillRect(0, 0, 160, 160);
  await model.predict(dummyCanvas);
  console.log("‚úÖ Model warmed up");
    }

window.addEventListener("load", () => {
  const overlay = document.getElementById("intro-overlay");
  const playButton = document.getElementById("play-intro");
  const skipButton = document.getElementById("skip-intro");

  const introText = "Hello! I'm BinBot, your eco-friendly AI helper. I help you sort waste smartly using your camera. Tap the Start camera. Point your camera at any common waste item. Tap the Identify button to start scanning.";

  playButton.addEventListener("click", () => {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(introText);
    utterance.rate = 0.8;
    utterance.pitch = 1.3;
	utterance.volume = 1;

    // Keep overlay visible until voice ends
    utterance.onend = () => {
      overlay.style.display = "none";
    };

    speechSynthesis.speak(utterance);
  });

  skipButton.addEventListener("click", () => {
    speechSynthesis.cancel();
    overlay.style.display = "none";
  });
});

    async function startCamera() {
  const video = document.getElementById("webcam");
  const message = document.getElementById("camera-message");

  try {
    // ‚úÖ Request standard back-facing camera (not wide-angle)
    const constraints = {
      video: {
        facingMode: { exact: "environment" },
        width: { ideal: 640 },
        height: { ideal: 480 },
        frameRate: { ideal: 30 }
      }
    };


    webcamStream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = webcamStream;
    video.play();

    // Detect actual camera used
    const track = webcamStream.getVideoTracks()[0];
    const settings = track.getSettings();
    const facingMode = settings.facingMode || "environment";

    // ‚úÖ Apply mirroring only for front camera
    if (facingMode === "user") {
      video.style.transform = "scaleX(-1)";
    } else {
      video.style.transform = "scaleX(1)";
    }

    // Hide message overlay
    message.style.display = "none";

    // Voice greeting after user interaction
    speechSynthesis.cancel();
    speak("Camera started.");
  } catch (err) {
    console.error("Camera error:", err);
    message.textContent = "‚ö†Ô∏è Unable to access camera. Please check permissions.";
    message.style.display = "block";
    speak("Oops! I couldn't access the camera.");
  }
}

   function stopCamera() {
  const video = document.getElementById("webcam");
  const message = document.getElementById("camera-message");

  if (webcamStream && webcamStream.getTracks) {
    webcamStream.getTracks().forEach(track => {
      if (track.readyState === "live") {
        track.stop();
      }
    });
    webcamStream = null;
    video.srcObject = null;
    message.style.display = "block"; // üëà Show message
    speechSynthesis.cancel();
    speak("Camera stopped.");
  } else {
    message.textContent = "‚ö†Ô∏è No active camera to stop.";
    message.style.display = "block";
    speak("No camera is currently running.");
  }
}

   

    async function identifyOnce() {
  const video = document.getElementById("webcam");
  const beam = document.getElementById("scan-beam");

  if (!model || !video.srcObject) {
    speak("Start the camera.");
    return;
  }

  // Show the scan beam
  beam.style.display = "block";

  // Capture frame
  const canvas = document.createElement("canvas");
canvas.width = video.videoWidth;
canvas.height = video.videoHeight;

const ctx = canvas.getContext("2d");
ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // Predict
  const prediction = await model.predict(canvas);

  // Hide the scan beam after prediction
  setTimeout(() => {
    beam.style.display = "none";
  }, 2000); // Optional delay to let beam animate

  // Continue with confidence logic...
  let highestClass = prediction[0].className;
  let highestProb = prediction[0].probability;
  for (let i = 1; i < prediction.length; i++) {
    if (prediction[i].probability > highestProb) {
      highestClass = prediction[i].className;
      highestProb = prediction[i].probability;
    }
  }

  const percent = (highestProb * 100).toFixed(1) + "%";
  const resultBox = document.getElementById("result-box");

  let emoji = "üå±";
   let resultClass = "result-default";

  if (highestClass.toLowerCase().includes("plastic")) {
    emoji = "üß¥";
    resultClass = "result-plastic";
  } else if (highestClass.toLowerCase().includes("paper")) {
    emoji = "üì∞";
    resultClass = "result-paper";
  } else if (highestClass.toLowerCase().includes("organic")) {
    emoji = "üçé";
    resultClass = "result-organic";
  }


  if (highestProb >= 0.85) {
    resultBox.textContent = `${emoji} Identified: ${highestClass} (${percent})`;
	resultBox.className = `result-box ${resultClass}`;
    speak(`Identified item is ${highestClass}`);
    triggerBurstEffect(highestClass);
	
	setTimeout(() => {
    resultBox.textContent = "Waiting for identification...";
    resultBox.className = "result-box result-default";
  }, 4000);

  } else {
    resultBox.textContent = `ü§î Still thinking... (${percent})`;
	resultBox.className = "result-box result-default";
    speak("Hmm... I‚Äôm not confident yet. Let me take another look!");
	
	 setTimeout(() => {
    resultBox.textContent = "Waiting for identification...";
    resultBox.className = "result-box result-default";
  }, 4000);

  }
}

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = 0.9;
  utterance.pitch = 1.3;
  utterance.volume = 1;
  

  const voices = speechSynthesis.getVoices();
  const preferredVoice = voices.find(v =>
    v.lang.startsWith("en") && v.name.toLowerCase().includes("aria")
  );
  if (preferredVoice) {
    utterance.voice = preferredVoice;
  }

  speechSynthesis.speak(utterance);
    }

	
	function triggerBurstEffect(className) {
  const mascot = document.getElementById("mascot-image");
  mascot.classList.add("bounce");
  setTimeout(() => mascot.classList.remove("bounce"), 600);
}

    
  </script>
</body>

</html>
